# Terraform AWS GitHub OIDC Template

This template creates AWS IAM roles and an OIDC provider for GitHub Actions to authenticate with AWS without using long-lived credentials.

## Features

- Creates GitHub OIDC provider in AWS
- Creates IAM roles with trust policies for specific GitHub repositories
- Grants AdministratorAccess to GitHub Actions roles
- Follows security best practices with repository-specific access
- Uses native Terraform for IAM policy documents

## Usage

1. Clone or use this template
2. Update `common.auto.tfvars` with your specific values
3. Run terraform commands

### Configuration

Edit `common.auto.tfvars` to configure:

```hcl
region = "<add region here>"
account_id = "<add account id here>"

github_repos = {
  "<add repo name here>" = {
    org       = "<add org here>"
    repo      = "<add repo here>"
    role_name = "<add new role name here>"
  }
}

tags = {
  ManagedBy  = "terraform"
  CreatedBy  = "Adam Sir"
  Repository = "<insert repo name here>"
}
```

### Deployment

```bash
terraform init
terraform plan
terraform apply
```

## GitHub Actions Workflow

Use the created roles in your GitHub Actions:

```yaml
name: Deploy
on:
  push:
    branches: [main]

permissions:
  id-token: write
  contents: read

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_ARN }}
          aws-region: us-east-1
      - name: Deploy
        run: |
          # Your deployment commands here
```

## Outputs

- `oidc_provider_arn`: ARN of the GitHub OIDC provider
- `role_arns`: Map of role names to ARNs
- `role_names`: Map of role names

## Security

- Roles are restricted to specific GitHub repositories
- Uses OIDC for secure, temporary credentials
- No long-lived AWS credentials required

## References

- [GitHub Documentation - Configuring OpenID Connect in Amazon Web Services](https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services)
- [AWS IAM OpenID Connect Provider Documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_create_oidc.html)
- [Terraform AWS Provider - IAM OpenID Connect Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_openid_connect_provider)

---
*README generated by Claude*